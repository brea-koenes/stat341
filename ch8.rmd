---
title: "ch8.rmd"
author: "Brea Koenes"
date: "10/24/2022"
output: html_document
---

```{r setup, include=FALSE}
# Load packages
library(bayesrules)
library(tidyverse)
library(ggformula)
library(dplyr)
library(bayesplot)
library(tidybayes)
library(posterior)
library(janitor)
library(rstan)
library(broom.mixed)
```

# Chapter 8

## 8.13

a.  

b.  

c.  

d.  

## 8.14

a.  

Beta-Binomial is the correct choice in model because the prior is binomial. Specifically, the subject either believes in climate change or does not.

b.  and c.

My prior would be Beta(1,2). It is the same as the authors.

d.  

```{r}
summary(pulse_of_the_nation)
```

150/1000= 15% don't believe it's real at all

e.  

```{r}
summarize_beta_binomial(alpha = 1, beta = 2, y = 150, n = 1000)
```

```{r}
qbeta(c(0.25, 0.975), 151, 852)
```

## 8.15

a.  

Given the credible interval above, we can keep our null hypothesis that it is over 10%.

b.  

```{r}
prior_prob <- pbeta(0.10, 1, 2)
prior_odds <- prior_prob / (1 - prior_prob)

post_prob <- 1-prior_prob 
post_prob
```

```{r}
post_odds <- post_prob / (1 - post_prob)
post_odds
```

c.  

```{r}
BF <- post_odds / prior_odds
BF
```

The posterior odds of our hypothesis are roughly 18 times higher than the prior odds

d.  

Our alternative hypothesis that pi is greater than 10% is statistically significant and likely to occur.

## 8.16

a.  

```{r}
require(rstan)

# STEP 1: DEFINE the model
model <- "
  data {
    int<lower = 0, upper = 1000> Y;
  }
  parameters {
    real<lower = 0, upper = 1> pi;
  }
  model {
    Y ~ binomial(150, pi);
    pi ~ beta(151, 852);
  }
"

# STEP 2: SIMULATE the posterior
sim <- stan(model_code = model, data = list(Y = 150), 
                chains = 4, iter = 5000*2, seed = 84735)
```

b.  

```{r}
require(bayesplot)

# Parallel trace plots & density plots
mcmc_trace(sim, pars = "pi", size = 0.5) + 
  xlab("iteration")
mcmc_dens_overlay(sim, pars = "pi")

# Autocorrelation plot
mcmc_acf(sim, pars = "pi")
```

c.  

```{r}
rhat(sim, pars = "pi")

neff_ratio(sim, pars = "pi")
```

R-hat is a convergence diagnostic; it tells us whether or not an MCMC algorithm has converged flag situations where the algorithm has failed converge. Effective sample size tells us the effectiveness of a sample chain; it estimates the sample size required to achieve the same level of precision if the pulse of the sample used was a simple random sample.

## 8.17

a.  

```{r}
tidy(sim, conf.int = TRUE, conf.level = 0.95)
```

b.  

```{r}
chains_df <- as.data.frame(sim, pars = "lp__", include = FALSE)
```

```{r}
chains_df |>
  mutate(exceeds = pi > 0.1) |> 
  tabyl(exceeds)
```

c.  

The approximations in parts a and b are fairly close to the actual posterior values calculated in Exercises 8.14 and 8.15.

## 8.18

a.  

```{r}
set.seed(1)

# Predict a value of Y' for each pi value in the chain
chains_df <- chains_df |>
  mutate(y_predict = rbinom(length(pi), size = 100, prob = pi))
```

b.  

```{r}
summary(chains_df)
```

c.  

```{r}
chains_df |>
  summarize(mean = mean(y_predict),
            lower_20 = quantile(y_predict, 0.2),
            upper_20 = quantile(y_predict, 0.8))
```

## 8.21

a.  

b.  

c.  

d.  

## 8.22

a.  

b.  

c.  

d.  

## 8.23

a.  

b.  

c.  

d.  

e.  

## 8.24

a.  

b.  

c.  
